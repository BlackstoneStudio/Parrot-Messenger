#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Load .env file if it exists
if [ -f .env ]; then
  export $(cat .env | grep -v '^#' | xargs)
fi

# Run lint-staged for code formatting
npx lint-staged

# Update coverage badge if explicitly requested via environment variable
if [ "$UPDATE_COVERAGE_BADGE" = "true" ] && [ -z "$CI" ]; then
  echo "Updating coverage badge..."
  npm run coverage:badge
  
  # Stage the README if it was modified
  if git diff --name-only | grep -q "README.md"; then
    git add README.md
    echo "âœ… Coverage badge updated in README.md"
  fi
fi
